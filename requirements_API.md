# Требования к бэкенду приложения
## Технологии
Язык приложения — JavaScript. 

Выполняется в среде Node.js v12.17.0.

Доступ к приложению по протоколу HTTP 1.1. 


## Общие требования
Приложение использует базу данных. БД — PostgreSQL. Приложение
взаимодействует с БД через npm-пакет  sequelize  поверх пакета  pg .
sequelize  — ORM для работы с различными БД в node.js.

Запросы логируются через модуль winston . Документация к приложению
осуществляется с помощью модуля  apidoc .

Приложение должно отвечать требованиям REST.

В приложении должен быть глобальный обработчик ошибок. При
возникновении исключений они должны быть обработаны, а приложение
должно продолжить работу.

Ошибки приложения (неуспешно обработанные
запросы, исключения; ответы, отличные от 2XX) должны логироваться в
отдельный файл  error.log

## Требования к URL
### Вспомогательные URL
- Должен присутствовать URL, через который можно проверить, что бэкенд
запущен и принимает запросы. При успешном ответе должен вернуться
статус  200 OK .
- Должен присутствовать URL, через который работает поиск станций
метро. В случае успешного поиска должны вернуться номер станции, её
цвет и название. Если станций несколько, для каждой должны
возвращаться номер, цвет и название. Если станция не найдена, должен
вернуться пустой список.
### URL для курьеров
- Должен присутствовать URL: при обращении к нему курьер может
зарегистрироваться в приложении. URL должен принимать
логин, пароль и имя курьера. Логин, хэш пароля и имя курьера
должны записываться в поля  login ,
passwordHash и firstName таблицы Couriers. В поле passwordHash хранится
хэш пароля, генерируется стандартными функциями, поэтому
соответствие хэш-пароль проверить можно через авторизацию.
- Поле login должно быть уникальным. При успешной регистрации
соответствующая запись должна появиться в базе. При неуспешной
должна вернуться ошибка. Подробнее об ошибках в
документации /docs/#api-Courier-CreateCourier
- Должен присутствовать URL для входа в учётную запись курьером. На вход
должны отправляться логин и пароль курьера. При успешном входе должен
вернуться  id  курьера. Если войти не удалось, должна вернуться ошибка.
- Должен присутствовать URL для удаления учётной записи курьера. На
вход должен подаваться id курьера в таблице Couriers. При удалении
связанные заказы в таблице Orders должны быть стёрты.
### URL для заказов
Каждый раз, когда какой-нибудь из URL возвращает полные данные о
заказе, ответ должен содержать и статус каждого заказа. В статусе должны
быть такие значения:
- 0 — заказ создан, больше ничего с ним не происходило;
- 1 — заказ принят курьером;
- 2 — заказ завершён;
- -1 — заказ отменён.

Статус должен вычисляться относительно значений полей в БД в
таблице Orders (см. пункт «Описание содержимого базы данных»). Поля
указаны в порядке приоритетности:
- finished = true -> status = 2
- cancelled = true -> status = -1
- inDelivery = true -> status = 1
- Остальные случаи  -> status = 0

Должен присутствовать URL для создания заказа. При создании заказа
- указываются следующие параметры:
- имя;
- фамилия;
- адрес;
- ближайшая станция метро;
- телефон;
- количество дней аренды;
- дата доставки;
- комментарий;
- список подходящих цветов.

При создании заказа ему должен быть присвоен индивидуальный номер для
отслеживания.

 Переданные параметры записываются в таблицу  Orders  следующим образом:
- имя: firstName
- фамилия: lastName
- адрес: address
- ближайшая станция метро: metroStation
- телефон: phone
- количество дней аренды: rentTime
- дата доставки: deliveryDate
- комментарий: comment
- список подходящих цветов: color
- номер отслеживания: track

Если заказ создан успешно, должен вернуться его номер отслеживания. В
противном случае должна вернуться ошибка. Подробнее об ошибках в
документации: /docs/#api-Orders-CreateOrder
- Должен присутствовать URL для получения данных о заказе по его
номеру отслеживания. На вход должен подаваться номер. Если
соответствующий заказ найден, должны вернуться данные о
нём. Иначе должна вернуться ошибка.
- Должен присутствовать URL для принятия заказа курьером. URL принимает
номер отслеживания заказа и id курьера. Если при принятии заказа
возникли проблемы, должна вернуться ошибка.
- Должен присутствовать URL для отмены заказа. URL принимает номер для
отслеживания заказа. В случае неуспешной отмены должна вернуться
ошибка.
- Должен присутствовать URL для завершения заказа. На вход подаётся
номер заказа. В случае неуспешного завершения должна вернуться
ошибка.
- Должен присутствовать URL для получения всех заказов, которые
соответствуют заданным параметрам. Параметры поиска — ближайшая
станция метро и id курьера. Также должны быть переданы ограничения по
количеству выводимых записей на странице и номер страницы. Подробнее
об ошибках и кейсах применения в документации: /docs/#api-OrdersGetOrdersPageByPage
- Должен присутствовать URL для получения количества выполненных
заказов курьера. На вход должен подаваться id курьера. Подробнее об
ошибках и кейсах использования в документации: /docs/#api-CouriersGetOrdersCountByCourierId
### Ограничение полей
| Элемент           | Требования | Обязательность | 
| ------------------|:--------:|:------------------:|
| login | Только английские буквы. Длина текста не менее 2 и не более более 10 символов. | Yes |
| firstName | Только английские и русские буквы. Длина текста не менее 2 и не более более 10 символов. | No |
| password | Только целые числа. Длина 4 символа — не больше и не меньше. | Yes |

## Описание содержимого базы данных
БД состоит из двух таблиц: Couriers и Orders. Первая таблица содержит данные
о курьерах, вторая — данные о заказах

### Couriers
| Название | Тип | Назначение |
| ---------|:---:|:----------:|
| login | строка | логин курьера |
| passwordHash | строка | захэшированный пароль курьера |
| firstName | строка | имя курьера |

### Orders
|Название | Тип | Назначение |
| ---------|:---:|:---------:|
| courierId | число | поле, связывающее эту таблицу с таблицей Couriers |
| firstName | строка | имя заказчика |
| lastName | строка | фамилия заказчика |
| address | строка | адрес |
| metroStation | строка | ближайшая станция метро |
| phone | строка | номер телефона |
| rentTime | число | срок аренды |
| deliveryDate | дата | дата доставки |
| track | число | номер отслеживания |
| color | массив строк | предпочитаемые цвета самоката |
| comment | строка | комментарий курьеру |
| cancelled | логический | заказ отменён |
| finished | логический | заказ доставлен |
| inDelivery | логический | заказ в процессе доставки |
